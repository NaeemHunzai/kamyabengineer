<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Advanced Solar Calculator — Polished UI</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --primary:#00796b; --accent:#06b6d4; --bg:#f5f7fa; --muted:#6b7280; --card:#fff; --radius:12px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
body{display:flex;flex-direction:column;min-height:100vh;overflow-x:hidden}

.wrap{max-width:520px;margin:0 auto;padding:12px;}
.header{display:flex;gap:12px;align-items:center;margin-bottom:8px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
.title{font-size:16px;font-weight:700}
.subtitle{font-size:12px;color:var(--muted)}

.stepper{display:flex;justify-content:space-between;align-items:center;margin:12px 0;position:relative;padding:0 6px}
.stepper::before{content:'';position:absolute;left:24px;right:24px;height:4px;background:#e6eef6;top:50%;transform:translateY(-50%);border-radius:999px}
.step-dot{z-index:2;width:32px;height:32px;border-radius:50%;background:#e6eef6;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:13px;color:#374151}
.step-dot.active{background:linear-gradient(90deg,var(--primary),var(--accent)); color:white}

.card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(16,24,40,0.06);padding:14px;margin-bottom:12px}
h2{color:var(--primary);margin:0 0 6px;font-size:15px}
label.rowLabel{display:flex;align-items:center;gap:8px;font-weight:700;font-size:13px;color:#374151}
.inputRow{display:grid;grid-template-columns:1fr 42px;gap:8px;align-items:center;margin-top:8px}
.inputRow.full{grid-template-columns:1fr}
.inputField{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;background:#fbfdff;font-size:14px}
.selectField{padding:10px;border-radius:8px;border:1px solid #e6eef6;background:#fbfdff}

.infoBtn{width:36px;height:36px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;border:none;background:#e6f7ff;color:#0369a1;font-weight:700;font-size:13px;cursor:pointer}
.actions{display:flex;gap:8px;margin-top:12px}
button{padding:10px;border-radius:8px;border:none;font-weight:700;cursor:pointer;font-size:14px}
.btn-primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;flex:1}
.btn-ghost{background:#fff;border:1px solid #e6eef6;color:var(--muted);flex:1}
.btn-secondary{background:#f3f4f6;color:#111;flex:1}

#resultsWrap{display:none}
.result-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.result-card{flex:1 1 calc(50% - 8px);min-width:150px;background:#fff;border-radius:8px;padding:10px;border:1px solid #e6eef6;display:flex;gap:10px;align-items:center}
.result-icon{font-size:18px;color:var(--primary);width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:rgba(0,121,107,0.06)}
.value{font-size:15px;font-weight:800;color:#0f1724}
.small{font-size:12px;color:var(--muted)}

.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#fffbeb;color:#92400e;padding:8px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.12);display:none;z-index:9999;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="logo">SV</div>
    <div>
      <div class="title">Advanced Solar Calculator</div>
      <div class="subtitle">PF fixed at 0.85 • Smart validation</div>
    </div>
  </div>

  <div class="stepper">
    <div id="dot1" class="step-dot active">1</div>
    <div id="dot2" class="step-dot">2</div>
    <div id="dot3" class="step-dot">3</div>
    <div id="dot4" class="step-dot">4</div>
  </div>

  <!-- Step 1 -->
  <div id="step1" class="card">
    <h2>Step 1: System Mode</h2>
    <label class="rowLabel">Select mode</label>
    <div class="inputRow full">
      <select id="systemMode" class="selectField">
        <option value="ongrid">On-Grid</option>
        <option value="hybrid">Hybrid</option>
        <option value="offgrid">Off-Grid</option>
      </select>
    </div>
    <div class="actions">
      <button class="btn-primary" onclick="goTo(2)">Next</button>
    </div>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="card" style="display:none">
    <h2>Step 2: Consumption & Sun</h2>
    <label class="rowLabel">Daily kWh</label>
    <div class="inputRow"><input id="dailyKwh" type="number" class="inputField"></div>
    <label class="rowLabel">Peak Sun Hours</label>
    <div class="inputRow"><input id="peakSun" type="number" class="inputField"></div>
    <div class="actions">
      <button class="btn-ghost" onclick="goTo(1)">Back</button>
      <button class="btn-primary" onclick="goTo(3)">Next</button>
    </div>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="card" style="display:none">
    <h2>Step 3: Panel & Battery</h2>
    <label class="rowLabel">Panel Wattage</label>
    <div class="inputRow"><input id="panelW" type="number" class="inputField" data-even="true"></div>
    <label class="rowLabel">Panel Efficiency (%)</label>
    <div class="inputRow"><input id="panelEff" type="number" class="inputField"></div>
    <label class="rowLabel">Roof Area (m²)</label>
    <div class="inputRow"><input id="roofArea" type="number" class="inputField" data-even="true"></div>
    <div id="batteryBlock">
      <label class="rowLabel">Autonomy (days)</label>
      <div class="inputRow"><input id="autonomy" type="number" class="inputField" data-even="true"></div>
    </div>
    <div class="actions">
      <button class="btn-ghost" onclick="goTo(2)">Back</button>
      <button class="btn-primary" onclick="goTo(4)">Calculate</button>
    </div>
  </div>

  <!-- Results -->
  <div id="resultsWrap" class="card">
    <h2>Results</h2>
    <div class="result-grid">
      <div class="result-card"><div class="result-icon"><i class="fa fa-solar-panel"></i></div><div><div class="value" id="resPanels">-</div><div class="small">Panels</div></div></div>
      <div class="result-card"><div class="result-icon"><i class="fa fa-battery-full"></i></div><div><div class="value" id="resBattery">-</div><div class="small">Battery (kWh)</div></div></div>
    </div>
    <div class="actions">
      <button class="btn-secondary" onclick="goTo(3)">Back</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
function showToast(msg, ms=2000){
  const t = document.getElementById('toast');
  t.innerText = msg;
  t.style.display='block';
  clearTimeout(t._hide);
  t._hide = setTimeout(()=>t.style.display='none',ms);
}

function goTo(step){
  if(step===2){
    const d = parseFloat(document.getElementById('dailyKwh').value);
    const s = parseFloat(document.getElementById('peakSun').value);
    if(isNaN(d)||d<=0){showToast('Enter valid daily consumption');return;}
    if(isNaN(s)||s<=0){showToast('Enter valid sun hours');return;}
  }
  if(step===3){
    const p = parseFloat(document.getElementById('panelW').value);
    const e = parseFloat(document.getElementById('panelEff').value);
    if(isNaN(p)||p<=0){showToast('Enter panel wattage');return;}
    if(isNaN(e)||e<=0){showToast('Enter panel efficiency');return;}
  }
  [1,2,3,4].forEach(i=>{
    document.getElementById('dot'+i).classList.toggle('active',i<=step);
  });
  document.getElementById('step1').style.display=(step===1?'block':'none');
  document.getElementById('step2').style.display=(step===2?'block':'none');
  document.getElementById('step3').style.display=(step===3?'block':'none');
  document.getElementById('resultsWrap').style.display=(step===4?'block':'none');
  document.getElementById('batteryBlock').style.display=(document.getElementById('systemMode').value!=='ongrid'?'block':'none');
  if(step===4){calculate();}
}

function calculate(){
  const d = parseFloat(document.getElementById('dailyKwh').value);
  const s = parseFloat(document.getElementById('peakSun').value);
  const p = parseFloat(document.getElementById('panelW').value);
  const e = parseFloat(document.getElementById('panelEff').value)/100;
  const roof = parseFloat(document.getElementById('roofArea').value);
  const mode = document.getElementById('systemMode').value;
  const need = d/0.85;
  const dailyWh = need*1000;
  const panelWh = p*e*s;
  let panels = Math.ceil(dailyWh/panelWh);
  if(roof && panels*p*1.7/1000 > roof){showToast('Roof area might be insufficient');}
  document.getElementById('resPanels').innerText = panels;
  if(mode!=='ongrid'){
    const auto = parseFloat(document.getElementById('autonomy').value)||1;
    document.getElementById('resBattery').innerText=(d*auto).toFixed(1);
  } else {
    document.getElementById('resBattery').innerText='N/A';
  }
}

/* enforce even numbers */
document.querySelectorAll('[data-even="true"]').forEach(el=>{
  el.addEventListener('blur',()=>{
    if(el.value==='')return;
    let v=parseInt(el.value,10);
    if(isNaN(v)||v<=0)return;
    if(v%2!==0){v++;el.value=v;showToast('Adjusted to even: '+v);}
    else{el.value=v;}
  });
});
</script>
</body>
</html>
