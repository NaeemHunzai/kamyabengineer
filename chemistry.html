<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solar Calculator</title>

<!-- Font + Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --primary:#00796b;
  --accent:#06b6d4;
  --bg:#f5f7fa;
  --muted:#6b7280;
  --card:#fff;
  --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
body{display:flex;flex-direction:column}

.wrap{flex:1;display:flex;flex-direction:column;width:100%;padding:12px}

/* stepper */
.stepper{display:flex;justify-content:space-between;align-items:center;margin:10px 0;position:relative;padding:0 6px}
.stepper::before{content:'';position:absolute;left:30px;right:30px;height:4px;background:#e6eef6;top:50%;transform:translateY(-50%);z-index:0;border-radius:999px}
.step-dot{z-index:2;width:32px;height:32px;border-radius:50%;background:#e6eef6;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;color:#374151}
.step-dot.active{background:linear-gradient(90deg,var(--primary),var(--accent)); color:white; box-shadow:0 4px 12px rgba(3,105,79,0.12)}

/* cards */
.card{background:var(--card);border-radius:var(--radius);box-shadow:0 4px 12px rgba(16,24,40,0.06);padding:14px;margin-bottom:10px}
h1{font-size:17px;margin:0}
h2{color:var(--primary);margin:0 0 6px;font-size:15px}
label{display:block;margin-top:8px;color:#374151;font-weight:600;font-size:13px}
.hint{font-size:12px;color:var(--muted);margin-top:4px}
input,select{width:100%;padding:9px 10px;border-radius:8px;border:1px solid #e6eef6;background:#fbfdff;font-size:14px;margin-top:4px}

/* layout */
.actions{display:flex;gap:8px;margin-top:12px}
button{padding:10px;border-radius:8px;border:none;font-weight:700;cursor:pointer;font-size:14px}
.btn-primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;flex:1}
.btn-ghost{background:#fff;border:1px solid #e6eef6;color:var(--muted);flex:1}
.btn-secondary{background:#f3f4f6;color:#111;flex:1}

/* results full-width */
#results{flex:1;display:none;flex-direction:column}
.result-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.result-card{flex:1 1 calc(50% - 8px);min-width:150px;background:linear-gradient(180deg,#ffffff,#fbffff);border-radius:8px;padding:10px;border:1px solid #e6eef6;display:flex;gap:8px;align-items:center}
.result-icon{font-size:18px;color:var(--primary);width:30px;height:30px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:rgba(0,121,107,0.06)}
.value{font-size:15px;font-weight:700;color:#0f1724}
.small{font-size:11px;color:var(--muted)}

.full-card{padding:10px;border-radius:10px;background:linear-gradient(90deg,#fff,#f7fcfb);border:1px solid #e6eef6;margin-top:8px;font-size:14px}

/* toast */
.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#fffbeb;color:#92400e;padding:8px 12px;border-radius:8px;box-shadow:0 4px 12px rgba(16,24,40,0.12);display:none;z-index:9999;font-size:13px}

@media (max-width:480px){
  .stepper::before{left:20px;right:20px}
  .result-card{flex:1 1 100%}
}
</style>
</head>
<body>

<div class="wrap">
  <!-- Stepper -->
  <div class="stepper">
    <div class="step-dot" id="dot1">1</div>
    <div class="step-dot" id="dot2">2</div>
    <div class="step-dot" id="dot3">3</div>
  </div>

  <!-- Step 1 -->
  <div class="card step" id="step1">
    <h2>System Details</h2>
    <label>System Type</label>
    <select id="systemType" onchange="toggleAutonomy()">
      <option value="grid">Grid-Tied</option>
      <option value="hybrid">Hybrid</option>
      <option value="offgrid">Off-Grid</option>
    </select>

    <label>Daily Energy Use (kWh)</label>
    <input type="number" id="dailyUse" min="1" placeholder="e.g. 20">

    <label>Peak Sun Hours</label>
    <input type="number" id="sunHours" min="1" step="0.1" placeholder="e.g. 5">

    <div id="autonomyField" style="display:none;">
      <label>Battery Autonomy (days)</label>
      <input type="number" id="autonomy" min="1" placeholder="e.g. 2">
    </div>

    <div class="actions">
      <button class="btn-primary" onclick="nextStep(2)">Next</button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="card step" id="step2" style="display:none;">
    <h2>System Components</h2>
    <label>Panel Wattage (W)</label>
    <input type="number" id="panelWatt" min="50" step="10" placeholder="e.g. 400">

    <label>System Efficiency (%)</label>
    <input type="number" id="efficiency" min="50" max="100" placeholder="e.g. 80">

    <label>Battery Voltage (V)</label>
    <select id="batteryVolt">
      <option value="12">12V</option>
      <option value="24">24V</option>
      <option value="48" selected>48V</option>
    </select>

    <div class="actions">
      <button class="btn-ghost" onclick="prevStep(1)">Back</button>
      <button class="btn-primary" onclick="nextStep(3)">Next</button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="card step" id="step3" style="display:none;">
    <h2>Additional Options</h2>
    <label>Battery Depth of Discharge (%)</label>
    <input type="number" id="dod" value="80">

    <label>Inverter Efficiency (%)</label>
    <input type="number" id="invEff" value="90">

    <div class="actions">
      <button class="btn-ghost" onclick="prevStep(2)">Back</button>
      <button class="btn-primary" onclick="calculate()">Calculate</button>
    </div>
  </div>

  <!-- Results -->
  <div id="results">
    <h2>Results</h2>
    <div class="result-grid">
      <div class="result-card">
        <div class="result-icon"><i class="fa-solid fa-solar-panel"></i></div>
        <div>
          <div class="value" id="arraySize">0 W</div>
          <div class="small">Solar Array Size</div>
        </div>
      </div>
      <div class="result-card">
        <div class="result-icon"><i class="fa-solid fa-th"></i></div>
        <div>
          <div class="value" id="panelsNeeded">0</div>
          <div class="small">Panels Needed</div>
        </div>
      </div>
      <div class="result-card">
        <div class="result-icon"><i class="fa-solid fa-battery-full"></i></div>
        <div>
          <div class="value" id="batteryBank">0 Ah</div>
          <div class="small">Battery Bank Size</div>
        </div>
      </div>
      <div class="result-card">
        <div class="result-icon"><i class="fa-solid fa-bolt"></i></div>
        <div>
          <div class="value" id="inverterSize">0 W</div>
          <div class="small">Inverter Size</div>
        </div>
      </div>
    </div>

    <div class="actions" style="margin-top:14px;">
      <button class="btn-secondary" onclick="exportPDF()">Export PDF</button>
      <button class="btn-ghost" onclick="resetCalc()">Reset</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
function showToast(msg){
  let t=document.getElementById("toast");
  t.innerText=msg; t.style.display="block";
  setTimeout(()=>{t.style.display="none";},2500);
}

function toggleAutonomy(){
  let type=document.getElementById("systemType").value;
  document.getElementById("autonomyField").style.display = 
    (type==="grid") ? "none" : "block";
}

function nextStep(step){
  if(step===2 && !document.getElementById("dailyUse").value){
    showToast("Enter daily usage");return;
  }
  document.querySelectorAll(".step").forEach(s=>s.style.display="none");
  document.getElementById("step"+step).style.display="block";
  updateStepper(step);
}
function prevStep(step){
  document.querySelectorAll(".step").forEach(s=>s.style.display="none");
  document.getElementById("step"+step).style.display="block";
  updateStepper(step);
}
function updateStepper(active){
  [1,2,3].forEach(n=>{
    document.getElementById("dot"+n).classList.remove("active");
  });
  document.getElementById("dot"+active).classList.add("active");
}

function calculate(){
  let daily=parseFloat(document.getElementById("dailyUse").value)||0;
  let sun=parseFloat(document.getElementById("sunHours").value)||1;
  let panelW=parseFloat(document.getElementById("panelWatt").value)||1;
  let eff=(parseFloat(document.getElementById("efficiency").value)||80)/100;
  let autonomy=parseFloat(document.getElementById("autonomy").value)||1;
  let volt=parseFloat(document.getElementById("batteryVolt").value)||48;
  let dod=(parseFloat(document.getElementById("dod").value)||80)/100;
  let invEff=(parseFloat(document.getElementById("invEff").value)||90)/100;
  let type=document.getElementById("systemType").value;

  // Solar array size (W)
  let arraySize = (daily*1000)/(sun*eff);
  let panels = Math.ceil(arraySize/panelW);

  // Battery bank (Ah) only for hybrid/offgrid
  let batteryBank=0;
  if(type!=="grid"){
    batteryBank = Math.ceil((daily*autonomy*1000)/(volt*dod*invEff));
  }

  // Inverter size ~ 25% more than peak load (assuming daily use ~ load)
  let inverterSize = Math.ceil((daily*1000)/sun*1.25);

  // Show results
  document.getElementById("arraySize").innerText = arraySize.toFixed(0)+" W";
  document.getElementById("panelsNeeded").innerText = panels;
  document.getElementById("batteryBank").innerText = batteryBank+" Ah";
  document.getElementById("inverterSize").innerText = inverterSize+" W";

  document.querySelectorAll(".step").forEach(s=>s.style.display="none");
  document.getElementById("results").style.display="flex";
  updateStepper(3);
}

function resetCalc(){
  location.reload();
}

function exportPDF(){
  const element=document.getElementById("results");
  html2pdf().from(element).set({
    margin:10,
    filename:"solar_results.pdf",
    html2canvas:{scale:2},
    jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}
  }).save();
}
</script>
</body>
</html>
