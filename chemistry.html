<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Solar Wizard</title>
<style>
  /* Light theme styling */
  body{margin:0;font-family:sans-serif;background:#f5f5f5;color:#333;}
  .container{max-width:480px;margin:20px auto;padding:20px;}
  .card{background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);padding:16px;margin-top:12px;}
  .step{display:none;}
  .step.active{display:block;}
  label{display:block; margin:12px 0 4px;font-weight:600;}
  input, select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;}
  button{margin-top:16px;padding:10px;background:#0077cc;color:#fff;border:none;border-radius:6px;width:100%;}
  .toggles{display:flex;gap:8px;}
</style>
</head>
<body>
<div class="container">
  <!-- Step 1 -->
  <div id="step1" class="card step active">
    <h2>Step 1: Tech Details</h2>
    <label>Daily Energy (kWh)</label><input id="consumption" type="number">
    <label>Peak Sun Hours</label><input id="psh" type="number">
    <label>Panel Wattage (W)</label><input id="watt" type="number">
    <label>Panel Efficiency (%)</label><input id="eff" type="number">
    <label>System Losses (%)</label><input id="loss" type="number">
    <div class="toggles">
      <label><input id="modeGrid" type="radio" name="mode" checked> Grid-Tied</label>
      <label><input id="modeOff" type="radio" name="mode"> Off-Grid</label>
    </div>
    <div id="offgridInputs" style="display:none;">
      <label>Autonomy (days)</label><input id="autonomy" type="number">
      <label>DoD (%)</label><input id="dod" type="number">
      <label>System Voltage (V)</label><input id="voltage" type="number">
    </div>
    <button onclick="goto(2)">Next</button>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="card step">
    <h2>Step 2: Constraints & Financials</h2>
    <label>Roof Area <span id="unitRoof">m²</span></label>
    <div class="toggles">
      <input id="roofVal" type="number"><button type="button" onclick="toggleRoofUnit()">Toggle m²/ft²</button>
    </div>
    <label>Install Cost ($/kW)</label><input id="costkw" type="number">
    <label>Tariff ($/kWh)</label><input id="tariff" type="number">
    <button onclick="goto(3)">Next</button>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="card step">
    <h2>Step 3: Results</h2>
    <div id="output"></div>
    <button onclick="resetAll()">Reset</button>
  </div>
</div>

<script>
  // Toggle off-grid inputs
  document.getElementById('modeOff').onchange = function(){
    document.getElementById('offgridInputs').style.display = 'block';
  };
  document.getElementById('modeGrid').onchange = function(){
    document.getElementById('offgridInputs').style.display = 'none';
  };

  // Toggle roof unit
  let roofUnit = 'm²';
  function toggleRoofUnit(){
    roofUnit = roofUnit==='m²'?'ft²':'m²';
    document.getElementById('unitRoof').innerText = roofUnit;
  }

  function goto(step){
    document.querySelectorAll('.step').forEach(el=>el.classList.remove('active'));
    document.getElementById('step'+step).classList.add('active');
    if(step===3) computeResults();
  }

  function computeResults(){
    const c = +document.getElementById('consumption').value;
    const p = +document.getElementById('psh').value;
    const w = +document.getElementById('watt').value;
    const e = +document.getElementById('eff').value;
    const l = +document.getElementById('loss').value;
    const botG = document.getElementById('modeOff').checked;
    const roof = +document.getElementById('roofVal').value;
    const costkw = +document.getElementById('costkw').value;
    const tariff = +document.getElementById('tariff').value;

    const dailyGen = w*(e/100)*p*(1 - l/100)/1000;
    const panels = Math.ceil(c / dailyGen);
    const systemKW = (panels*w)/1000;
    const cost = systemKW * costkw;
    const savingsYear = c * 365 * tariff;
    const payback = cost/savingsYear;

    let html = `
      <p><b>Panels:</b> ${panels}</p>
      <p><b>Generation/day:</b> ${dailyGen.toFixed(2)} kWh</p>
      <p><b>System Size:</b> ${systemKW.toFixed(2)} kW</p>
      <p><b>Cost:</b> $${cost.toFixed(0)}</p>
      <p><b>Yearly Savings:</b> $${savingsYear.toFixed(0)}</p>
      <p><b>Payback:</b> ${payback.toFixed(1)} yrs</p>
    `;
    if(botG){
      const a = +document.getElementById('autonomy').value;
      const dod = +document.getElementById('dod').value/100;
      const volt = +document.getElementById('voltage').value;
      html += `<p><i>Off-grid battery sizing can be added later</i></p>`;
    }
    document.getElementById('output').innerHTML = html;
  }

  function resetAll(){
    document.querySelectorAll('input').forEach(i=>i.value='');
    goto(1);
  }
</script>
